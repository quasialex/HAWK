<a class="back" href="/">← Home</a>
<h2>Tasks</h2>

<% if @tasks.empty? %>
  <p class="muted">No running tasks.</p>
<% else %>
  <ul class="tasks">
    <% @tasks.reverse.each do |t| %>
      <li class="task <%= 'hl' if @highlight == t['session'] %>">
        <div>
          <div class="title"><%= @mods_map[t['module_id']]&.label || t['module_id'] %> — <code><%= t['action'] %></code></div>
          <div class="muted">Session <code><%= t['session'] %></code> • <%= t['started'] %></div>
          <div class="muted">CMD: <code><%= t['cmd'] %></code></div>
        </div>
        <div class="actions">
          <a class="pill" href="/log?file=<%= File.basename(t['log']) %>">Preview</a>
          <a class="pill" href="/stream?session=<%= t['session'] %>">Live</a>
          <form method="post" action="/tasks/<%= t['session'] %>/stop">
            <button class="danger" type="submit">Stop</button>
          </form>
        </div>
      </li>
    <% end %>
  </ul>
<% end %>
